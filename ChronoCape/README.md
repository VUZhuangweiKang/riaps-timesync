# ChronoCape for Project RIAPS

*Author: Peter Volgyesi <peter.volgyesi@vanderbilt.edu>*
*Copyright (C) 2016 Vanderbilt University, ISIS.*

This board provides instrumentation and limited simulation services for 
real-time applications running on a BeagleBone Black (BBB) computer.
The primary service is the accurate timestamping of events generated by
the BBB.

## Revision history

### RevA

Initial prototype.

__Issues w/ RevA__
  - SCH: a dedicated I2S DAC would be nicer, eg: PCM5101A/B (https://www.element14.com/community/community/designcenter/single-board-computers/next-gen_beaglebone/blog/2013/07/06/bbb--building-a-dac)
  - BOM: Sparkfun WRL-00593 is not footprint compatible with Molex 0732511150

## TODO
  - REIMBURSEMENT: DigiKey order ($146.87)
  - REIMBURSEMENT: PCBCART order ($157.75)
  - REIMBURSEMENT: SMA connector & 2x23 pin from Sparkfun ($43.85)

## Parts

  - STM32L476RG (Digikey)
  - LEA-6T (Digikey)
  - LP5907 (Digikey)
  - SMA Connectors
    - CONSMA001(-G) - SMA Connector Vertical (Digikey)
    - CONSMA002(-G) - SMA Connector RA (Digikey)
    - CONSMA003.062/CONSMA003.031 - SMA Connector Edge (Digikey)
  - 20218 - Stackable Header (Sparkfun or Adafruit) 
  - UX60A-MB-5ST - USB Mini-B Connector (Digikey)
  - SJ-3523-SMT - Stereo Jack (Digikey)
  - Dialight 598 Series - LEDs (Digikey)
  - B0520LW - Schottky Diode (Digikey)
  - ASTX-H11-20.000MHZ-T - TCXO (Digikey)
  - NCP2811 - Audio Amp (Digikey) (https://www.element14.com/community/community/designcenter/single-board-computers/next-gen_beaglebone/blog/2013/07/06/bbb--building-a-dac)
  - SN74AUP1T57DBVR - EXTSYNC buffer (http://files.ettus.com/schematics/b200/b210.pdf)

??? STlink JTAG and Cortex JTAG

## Power

Power sources (combined with Schottky diodes)
  - BeagleBone Black 5V network (SYS_5V)
  - USB Micro-B connector
  - ST-Link V2 header

Dedicated LDO for cleaner 3.3V, enabled by
  1, VDD_3V3B from BBB - this is the default (preventing clamp currents)
  2, Optional (selected by jumper): from the combined 5V input source (always on)

Extra EMI filering at the input of LEA-6T

Power requirements:

| Component   | Peak (mA) | Average (mA) |
|-------------|-----------|--------------|
| LEA-6T      |        67 |           40 |
| STM32L4     |        15 |           10 |
| VCTXO       |         5 |            5 |
| Audio Amp   |           |              |
| Sync Buffer |           |              |
| SUM         |           |              |

## LEDs

**Red**:    app (Dialight 598-8010-107F, 2.2V)
**Green**:  app (Dialight 598-8070-107F, 2V)
**Orange**: GPS lock (Dialight 598-8030-107F, 2V)

## BBB Expansion Pin Assignments

Also, see: http://elinux.org/Beagleboard:Cape_Expansion_Headers
(*) means available for further use



TIMEPULSE2 -> TIM3_CH4 -> TIMER6 (optional)



### P8

| Pin# | BBB Signal | ChronoCape | STM32 | AM335x | Comments |
|:----:|-----------:|-----------:|:-----:|:------:|----------|
|   1  |       DGND |        GND |       |        |          |
|   2  |       DGND |        GND |       |        |          |
|  3-6 |    MMC_XXX |            |       |   NNN  | eMMC: DO NOT USE |
|   7  |     TIMER4 |     TIMER4 |       |        | STM32_TIM2_CH1, GPS_TIMEPULSE |
|   8  |     TIMER7 |            |       |        | *        |
|   9  |     TIMER5 |     TIMER5 |  PA6  |        | STM32_TIM3_CH1, EXTSYNC |
|  10  |     TIMER6 |     TIMER6 |  PB1  |        | STM32_TIM3_CH4, GPS_TIMEPULSE2 |
|  11  |   GPIO1_13 |            |       |        | *        |
|  12  |   GPIO1_12 |            |       |        | *        |
|  13  |   EHRPWM2B |   EHRPWM2B |  PA2  |        | STM32_TIM2_CH3 |
|  14  |   GPIO0_26 |            |       |        | *        |
|  15  |   GPIO1_15 |            |       |        | *        |
|  16  |   GPIO1_14 |            |       |        | *        |
|  17  |   GPIO0_27 |            |       |        | *        |
|  18  |    GPIO2_1 |            |       |        | *        |
|  19  |   EHRPWM2A |   EHRPWM2A |  PA1  |        | STM32_TIM2_CH2, GPS_EXTINT0 |
| 20-25|    MMC_XXX |            |       |   NNN  | eMMC: DO NOT USE |
| 27-46|    LCD_XXX |            |       |   NNN  | HDMI, SYSBOOT: DO NOT USE |


### P9

| Pin# | BBB Signal | ChronoCape | STM32 | AM335x | Comments |
|:----:|-----------:|-----------:|:-----:|:------:|----------|
|   1  |       DGND |        GND |       |        |          |
|   2  |       DGND |        GND |       |        |          |
|   3  |   VDD_3V3B |   VDD_3V3B |       |        |          |
|   4  |   VDD_3V3B |   VDD_3V3B |       |        |          |
|   5  |     VDD_5V |            |       |        |          |
|   6  |     VDD_5V |            |       |        |          |
|   7  |     SYS_5V |     SYS_5V |       |        |          |
|   8  |     SYS_5V |     SYS_5V |       |        |          |
|   9  |    PWR_BUT |            |       |        |          |
|  10  | SYS_RESETn |            |       |        |          |
|  11  |  UART4_RXD |            |       |        | *        |
|  12  |   GPIO1_28 |            |       |        | *        |
|  13  |  UART4_TXD |            |       |        | *        |
|  14  |   EHRPWM1A |   EHRPWM1A |  PA7  |        | STM32_TIM3_CH2 |
|  15  |   GPIO1_16 |            |       |        | also connected to GPIO2_0 (not on header), avoid this |
|  16  |   EHRPWM1B |   EHRPWM1B |  PB0  |        | STM32_TIM3_CH3 |
|  17  |   I2C1_SCL |            |       |        | *        |
|  18  |   I2C1_SDA |            |       |        | *        |
|  19  |   I2C2_SCL |   I2C2_SCL |  PB10 |        | Board EEPROM id (emulated by STM32), ADD PULLUP |
|  20  |   I2C2_SDA |   I2C2_SDA |  PB11 |        | Board EEPROM id (emulated by STM32), ADD PULLUP |
|  21  |  UART2_TXD |            |       |        | *        |
|  22  |  UART2_RXD |            |       |        | *        |
|  23  |   GPIO1_17 |            |       |        | *        |
|  24  |  UART1_TXD |  UART1_TXD |  PC5  |        | STM32_USART3_RX |
|  25  |   GPIO3_21 |            |       |        | McASP0 clock: DO NOT USE |
|  26  |  UART1_RXD |  UART1_RXD |  PC4  |        | STM32_USART3_TX|
|  27  |   GPIO3_19 |            |       |        | *        |
|  28  |   SPI1_CS0 |            |       |        | Also used for HDMI, avoid this |
|  29  |    SPI1_D0 |            |       |        | Also used for HDMI, avoid this |
|  30  |    SPI1_D1 |            |       |        | Also used for HDMI, avoid this |
|  31  |  SPI1_SCLK |            |       |        | Also used for HDMI, avoid this |
|  32  |    VDD_ADC |            |       |        | Out analog outputs are from VDD |
|  33  |       AIN4 |            |       |        | *        |
|  34  |   GNDA_ADC |       AGND |       |        |          |
|  35  |       AIN6 |            |       |        | * analog only (1.8V) |
|  36  |       AIN5 |       AIN5 |  PA4  |        | STM32_DAC1_OUT1 output, voltade divider, also on headphone amp |
|  37  |       AIN2 |            |       |        | * analog only (1.8V) |
|  38  |       AIN3 |       AIN3 |  PA5  |        | STM32_DAC1_OUT2 output, voltade divider, also on headphone amp |
|  39  |       AIN0 |            |       |        | * analog only (1.8V) |
|  40  |       AIN1 |            |       |        | * analog only (1.8V) |
|  41  |    CLKOUT2 |    CLKOUT2 |  PA3  |        | STM32_TIM2_CH4, Also connected to GPIO3_20 (not on header)|
|  42  |    GPIO0_7 |            |       |        | Also connected to GPIO3_18 (not on header), avoid this |
|  43  |       DGND |        GND |       |        |          |
|  44  |       DGND |        GND |       |        |          |
|  45  |       DGND |        GND |       |        |          |
|  46  |       DGND |        GND |       |        |          |


## Antenna options
